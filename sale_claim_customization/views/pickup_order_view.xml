<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="pickup_order_tree" model="ir.ui.view">
            <field name="name">pickup.order.tree</field>
            <field name="model">pickup.order</field>
            <field name="arch" type="xml">
                <tree string="Pickup orders" decoration-muted="state=='done'">
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="sale_order_id"/>
                    <field name="expected_date"/>
                    <field name="type"/>
                    
                </tree>
            </field>
        </record>

        <record id="pickup_order_form" model="ir.ui.view">
            <field name="name">pickup.order.form</field>
            <field name="model">pickup.order</field>
            <field name="arch" type="xml">
                <form string="Pickup order">
                    <header>
                        <button name="action_done" string="Done" states="draft" type="object" class="oe_highlight"/>
                        <button name="action_assign_travel" states="done" string="Assign travel" type="object"
                            attrs="{'invisible': ['|', ('travel_id', '!=', False)]}"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,done,received,cancel"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button type="object"
                                name="action_view_picking"
                                class="oe_stat_button"
                                icon="fa-truck" attrs="{'invisible':[('state', '=', 'draft'),('picking_ids','=',[])]}">
                                <field name="picking_count" widget="statinfo" string="Shipment" help="Incoming Shipments"/>
                                <field name="picking_ids" invisible="1"/>
                            </button>
                        </div>
                        <group>
                            <group>
                                <field name="name" attrs="{'invisible': [('state','=', 'draft')], 'readonly': [('state','!=', 'draft')]}"/>
                                <field name="emission_date"/>
                                <field name="expected_date"/>
                                <field name="make_payment"/>
                                <field name="amount" attrs="{'invisible': [('make_payment','=', False)], 'required': [('make_payment','=', True)]}"/>
                            </group>
                            <group>
                                <field name="partner_id"/>
                                <field name="sale_order_id" options="{'no_create_edit': True}"
                                       domain="[('partner_id', '=', partner_id), ('state', '=', 'sale'), ('travel_id.state', '=', 'delivered')]"/> <!--('travel_id.state', 'in', ('delivered', 'completed'))-->
                                <field name="claim_id" readonly="1"/>
                                <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
                                <field name="type"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Articles with problems">
                                <field name="domain_line_ids" widget="many2many_tags" invisible="1"/>
                            </page>
                            <page string="Others Information">
                                <group string="Shipping Information" name="pickup_shipping">
                                    <field name="warehouse_id" options="{'no_create': True}" groups="stock.group_stock_multi_locations"/>
                                    <field name="picking_type_id" options="{'no_create': True}" groups="stock.group_stock_multi_locations"/>
                                    <field name="travel_id" readonly="True"/>
                                    <field name="group_id" readonly="True"/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="pickup_order_action" model="ir.actions.act_window">
            <field name="name">Pickup orders</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">pickup.order</field>
            <field name="view_mode">tree,form</field>
        </record>

        <menuitem action="pickup_order_action"
                  name="Pickup orders"
                  id="pickup_order_menu"
                  sequence="3"
                  parent="crm_claim.menu_aftersale" />

        <record id="pickup_order_line_tree" model="ir.ui.view">
            <field name="name">pickup.order.line.tree</field>
            <field name="model">pickup.order.line</field>
            <field name="arch" type="xml">
                <tree string="Pickup orders lines">
                    <field name="label"/>
                    <field name="product_id"/>
                    <field name="length"/>
                    <field name="height"/>
                    <field name="width"/>
                </tree>
            </field>
        </record>

        <record id="pickup_order_line_form" model="ir.ui.view">
            <field name="name">pickup.order.line.form</field>
            <field name="model">pickup.order.line</field>
            <field name="arch" type="xml">
                <form string="Pickup order line">
                    <sheet>
                        <group>
                            <group>
                                <field name="label" readonly="1"/>
                                <field name="product_id" readonly="1"/>
                            </group>
                            <group>
                                <field name="length" readonly="1"/>
                                <field name="height" readonly="1"/>
                                <field name="width" readonly="1"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="pickup_order_manufacturing_tree" model="ir.ui.view">
            <field name="name">pickup.order.manufacturing.tree</field>
            <field name="model">pickup.order.manufacturing</field>
            <field name="arch" type="xml">
                <tree string="Pickup orders manufacturing">
                    <field name="label"/>
                    <field name="product_id"/>
                    <field name="product_uom_id"/>
                    <field name="product_qty"/>
                    <field name="production_id"/>
                    <field name="state_production"/>
                </tree>
            </field>
        </record>

        <record id="pickup_order_manufacturing_form" model="ir.ui.view">
            <field name="name">pickup.order.manufacturing.form</field>
            <field name="model">pickup.order.manufacturing</field>
            <field name="arch" type="xml">
                <form string="Pickup order manufacturing">
                    <sheet>
                        <group>
                            <group>
                                <field name="label" readonly="1"/>
                                <field name="product_id" readonly="1"/>
                                <field name="production_id" readonly="1"/>
                                <field name="state_production" readonly="1"/>
                            </group>
                            <group>
                                <field name="product_uom_id" readonly="1"/>
                                <field name="product_qty" readonly="1"/>
                                <field name="length" readonly="1"/>
                                <field name="height" readonly="1"/>
                                <field name="width" readonly="1"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="assign_pickup_travel_action" model="ir.actions.server">
            <field name="name">Assign travel</field>
            <field name="model_id" ref="model_pickup_order"/>
            <field name="state">code</field>
            <field name="condition">True</field>
            <field name="code">
                if context.get('active_model') == 'pickup.order' and context.get('active_ids'):
                    action = env['pickup.order'].browse(context['active_ids']).action_assign_travel()
            </field>
        </record>
        <record id="assign_pickup_travel_action2" model="ir.values">
                <field name="name">Assign travel</field>
                <field name="model">pickup.order</field>
                <field name="key" >action</field>
                <field name="key2">client_action_multi</field>
                <field name="value" eval="'ir.actions.server,%d'%assign_pickup_travel_action"/>
        </record>
    </data>
</odoo>
